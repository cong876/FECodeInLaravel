function getFieldValue(a,b,c){return a[b]?c(a.$parent):a.$parent?getFieldValue(a.$parent,b,c):(console.log("no this key in all scope"),!1)}function yeyePrevent(){return{priority:0,link:function(a,b,c){b.on("click",function(b){b.preventDefault(),b.stopImmediatePropagation(),c.ngClick&&a.$apply(c.ngClick)})}}}function yeyeBg(){return{compile:function(a,b){return function(a,b,c){var d=/\.jpg$|\.png$|\.webp$|\.gif$/;c.yeyeBg.match(d)?b.css({"background-image":"url("+c.yeyeBg+")"}):a.$watchCollection(c.yeyeBg,function(a){b.css({"background-image":"url("+a+")"})})}}}}function yeyePrice(){return{compile:function(a,b){return function(a,b,c){a.$watchCollection(c.yeyePrice,function(a){b.text("￥"+parseFloat(a).toFixed(2))})}}}}function yeyeNumber(){return{priority:0,scope:{yeyeNumber:"="},link:function(a,b,c){b.on("click",function(b){var d="add"===c.yeyeNumberMethod?1:-1;a.yeyeNumber+d>0&&a.$apply(function(a){a.yeyeNumber+=d,c.yeyeTotal&&getFieldValue(a,c.yeyeTotal,function(a){a[c.yeyeTotal]+=d})})})}}}function yeyeVerify(a,b){return{require:"ngModel",scope:{mobile:"=yeyeVerify",zone:"=yeyeZone",code:"=ngModel"},link:function(c,d,e,f){d.on("input",function(e){if(e.preventDefault(),d.val().length>=6){f.$setValidity("yeyeVerify",void 0);var g={zone:a.trim(c.zone),mobile:a.trim(c.mobile),verifyCode:a.trim(c.code)};a.yeyeReq(!1,!1,"GET",b.verifyCode,g).then(function(a){200==a.status_code?f.$setValidity("yeyeVerify",!0):(f.$setValidity("yeyeVerify",!1),alert(a.message))})}})}}}function yeyeCountdown(a,b,c){return{scope:{isDisabled:"=ngDisabled",mobile:"=ngModel",zone:"=yeyeZone"},link:function(d,e,f){d.$on("$destroy",function(a){c.register=!1}),e.on("click",function(e){if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!this.disabled&&!c.register){c.register=!0;var g,h=angular.element(this),i=this,j=h.text(),k=f.yeyeCountdown,l=function(a){alert(a),clearTimeout(m),c.register=!1,h.attr({disabled:!1}),h.removeAttr("disabled")};h.attr({disabled:"disabled"});var m=setTimeout(function(){c.register=!1},parseInt(1e3*k.match(/[0-9]{1,}/)[0]));if(f.ngModel){var n={mobile:a.trim(d.mobile),zone:a.trim(d.zone)};a.yeyeReq(!1,!1,"GET",b.checkMobile,{mobile:n.mobile}).then(function(c){return 200==c.status_code?a.yeyeReq(!1,!1,"GET",b.getVerifyCode,n):(l(c.message),!1)}).then(function(a){a&&(200==a.status_code?countdownStart(i,h,k,j,g,d):l(a.message))},function(a){l(a)})}}})}}}function countdownStart(a,b,c,d,e,f){b.attr({disabled:"disabled"});var g=parseInt(c.match(/[0-9]{1,}/)[0]);c=c.split(/[0-9]{1,}/),b.css({width:getComputedStyle(a).width}),b.text(c[0]+g+c[1]),e=setInterval(function(){g>0?(g-=1,b.text(c[0]+g+c[1])):(f.isDisabled||(b.attr({disabled:!1}),b.removeAttr("disabled")),countdownEnd(b,d,e))},1e3)}function countdownEnd(a,b,c){a.text(b),clearInterval(c)}function yeyeCarousel(a,b){return{scope:{pictures:"=yeyeCarousel",interval:"=yeyeInterval",targets:"=yeyeTargets"},template:'<div class="carouselOuter"><ul><li><div class="rectImage"></div></li><li><div class="rectImage"></div></li><li><div class="rectImage"></div></li></ul></div>',link:function(c,d,e){function f(a){var b=j.children();if(h.length>1){var c=a+1==h.length?0:a+1,d=a-1==-1?h.length-1:a-1;b.eq(0).children().css({backgroundImage:"url("+h[d]+")"}),b.eq(1).children().css({backgroundImage:"url("+h[a]+")"}),b.eq(2).children().css({backgroundImage:"url("+h[c]+")"})}else b.eq(1).children().css({backgroundImage:"url("+h[0]+")"})}function g(){var b=j.children();b.eq(1).css({"-webkit-transform":"translate3d(-100%, 0, 0)",transform:"translate3d(-100%, 0, 0)"}),b.eq(2).css({"-webkit-transform":"translate3d(0, 0, 0)",transform:"translate3d(0, 0, 0)"}),b.eq(0).remove(),j.append('<li><div class="rectImage"></div></li>'),d.children().children().eq(1).children().eq(k).removeClass("active"),k=k+1==h.length?0:k+1,d.children().children().eq(1).children().eq(k).addClass("active"),a(function(){f(k)},450,1)}var h=c.pictures,i=c.targets,j=d.children().children().eq(0),k=0;if(d.on("click",function(){var a=i[k].state,c=i[k].id;b.go(a,{id:c}),toTalkingData({event:"周期团购",area:"banner区块-点击主题性活动",kv:{activity_title:i[k].title,activity_id:c.toString()},user:!0})}),f(0),h.length>1){for(var l='<div class="carouselMark">',m=0;m<h.length;m++)l+="<a>●</a>";l+="</div>",d.children().append(l),d.children().children().eq(1).children().eq(k).addClass("active");var n=a(function(){g()},parseInt(c.interval));c.$on("$destroy",function(){a.cancel(n)})}}}}function loading(){return{replace:!0,restrict:"E",template:'<div class="spinner"><div class="spinner-container container1"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container2"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container3"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div></div>'}}function overView(){return{replace:!0,restrict:"E",template:'<section class="box overView"><div><div><div class="squareImage" yeye-bg="image"></div></div></div><div><p ng-bind="title"></p><p><span>&times;</span><span ng-bind="number"></span><b ng-if="price" class="right" yeye-price="price"></b></p></div></section>',scope:{image:"@image",title:"@title",number:"@number",price:"@price"}}}function activityPreview(a,b){return{replace:!0,restrict:"E",template:'<div><div class="splitArea"><div><hr></div><div>逛一逛</div><div><hr></div></div><div class="activityItemArea"><span ng-repeat="item in items"><div class="itemContainer" ng-click="goActivity(item.id)"><div class="itemPictureContainerA"><div class="squareImage" yeye-bg="item.pic_url"></div></div><p class="itemTitle" ng-bind="item.title"></p><p><span class="itemPrice" yeye-price="item.price"></span><span class="marketPrice" yeye-price="item.marketPrice"></span></p></div> </span><div class="itemContainer left_fix"></div><div class="splitArea" ng-click="goActivity()"><div><hr></div><div>点击查看更多</div><div><hr></div></div></div></div>',scope:{url:"="},link:function(c){a.yeyeReq(!1,!1,"GET",c.url).then(function(a){c.items=a.data}),c.goActivity=function(a){b.path("/periodActivity").replace().hash("item"+a)}}}}function logisticsPreview(a){return{replace:!0,restrict:"E",template:'<div class="box" ui-sref="buyerAdmin.orders.list.detail.logistics({orderId: orderId})"><div><span class="icon-delivered"></span></div><div><div ng-if="!logistics" class="paddingR"><loading></loading></div><p class="obvious" ng-bind="firstLog.context"></p><p ng-bind="firstTime"></p></div><div><span>></span></div></div>',scope:{orderId:"="},link:function(b){a.initLogistics(b.orderId,function(a){var c=a.list;b.logistics=c,b.firstLog=c.track_log[c.track_log.length-1],b.firstTime=b.firstLog?b.firstLog.time:"暂无物流信息"})}}}function yeyeTimer(a){return{replace:!0,restrict:"E",template:'<div style="display: inline-block"><span>00</span>:<span>00</span>:<span>00</span></div>',scope:{serverTime:"=serverTime",deadline:"=deadline",updateAt:"=updateAt",timerEnd:"=timerEnd",timerCheck:"=timerCheck"},link:function(b,c){var d=b.deadline,e=b.serverTime,f=b.updateAt,g=d.split(/[- :]/),h=e.split(/[- :]/),i=new Date(g[0],g[1]-1,g[2],g[3],g[4],g[5]),j=new Date(h[0],h[1]-1,h[2],h[3],h[4],h[5]),k=f-j,l=angular.element(c.children()[0]),m=angular.element(c.children()[1]),n=angular.element(c.children()[2]),o=a(function(){if(b.timerCheck&&i-new Date+k<=3e5&&b.timerCheck(),i-new Date+k<=0)return b.timerEnd(),a.cancel(o),!1;var c=Math.floor((i-new Date+k)/36e5),d=Math.floor((i-new Date+k)%36e5/6e4),e=Math.floor((i-new Date+k)%36e5%6e4/1e3);l.text(10>c?"0"+c:c),m.text(10>d?"0"+d:d),n.text(10>e?"0"+e:e)},1e3,0,!1);b.$on("$destroy",function(){a.cancel(o)})}}}function secKills(a,b,c,d){return{replace:!0,restrict:"E",template:'<div style="background-color:#f5f5f5"><div class="box specialItemContainer" ng-repeat="secKill in secKills"><div><div class="squareImage" yeye-bg="secKill.item.pic_url"></div></div><div class="specialItem"><div><span class="largeSize" ng-bind="secKill.item.title"></span></div><div class="box"><div><p class="obvious">￥{{secKill.item.price.substr(0, secKill.item.price.length-1)}}</p><p class="unobvious">国内<span yeye-price="secKill.item.market_price"></span></p></div><div class="btnArea"><p class="obvious center" ng-show="!secKill.started"><img src="http://7xnzm2.com2.z0.glb.qiniucdn.com/clock.png"><yeye-timer ng-show="secKill.willStart" server-time="serverTime" update-at="secKillsOuter.updateAt" deadline="secKill.start_time" timer-end="setStart" timer-check="setWillStart"></yeye-timer><span ng-show="!secKill.willStart">{{secKill.start_time.substr(11,5)}}开抢</span></p><div class="yeye_btn can_get_btn" ng-if="secKill.willStart && !secKill.started">即将开始</div><div class="yeye_btn can_get_btn" ng-if="secKill.started && secKill.is_on_shelf && user.can_sec_kill" ng-click="buy(secKill.item);burying(secKill, 0)">马上抢</div><div class="yeye_btn cannot_get_btn" ng-if="secKill.started && (!secKill.is_on_shelf || !user.can_sec_kill)" ng-click="burying(secKill, 1)">抢光了</div><div ng-show="!secKill.started && !secKill.willStart"><div class="yeye_btn black_btn remind_btn" ng-show="!secKill.reminded" ng-click="setRemind(secKill);burying(secKill, 2)">提醒我</div><div class="yeye_btn black_btn cancel_remind_btn" ng-show="secKill.reminded" ng-click="cancelRemind(secKill);burying(secKill, 3)">取消提醒</div></div></div></div></div></div></div>',scope:{serverTime:"=serverTime",user:"=user"},link:function(e,f,g){function h(){b.data[g.state+"Kills"]?b.useData(i,g.state+"Kills",!1,!0):(b.data[g.state+"Kills"]=b.newData(g.url),h())}function i(a){a.list.map(function(a){a.willStart=!1,a.item.pic_url=JSON.parse(a.item.pic_urls)[0],a.item.id=a.item.item_id}),e.secKillsOuter=a,e.secKills=a.list}e.setStart=function(){this.$parent.$apply(function(a){a.secKill.started=!0})},e.setWillStart=function(){this.$parent.secKill.willStart||this.$parent.$apply(function(a){a.secKill.willStart=!0})},e.setRemind=function(a){c.yeyeReq(!1,!1,"POST","/api/secKill/"+a.id+"/user/"+e.user.hlj_id+"/remind").then(function(b){a.reminded=!0})},e.cancelRemind=function(a){c.yeyeReq(!1,!1,"POST","/api/secKill/"+a.id+"/user/"+e.user.hlj_id+"/cancelRemind").then(function(b){a.reminded=!1})},e.buttonClick=new Date,e.buy=function(f){if(!c.getUser().mobile)return $location.path("/buyerRegister"),!1;if(new Date-e.buttonClick<300)return!1;e.buttonClick=new Date,b.data.currentKills.list.map(function(a){a.item.item_id==f.item_id&&(a.is_on_shelf=!1,e.user.can_sec_kill=!1)});var g={item_id:f.id,order_memo:f.order_memo,number:f.number};c.yeyeReq(!0,!0,"POST",d.createOrder,g).then(function(b){a.go("buyerAdmin.orders.list.pay",{state:"waitPay",id:b.data.id})})};var j=["秒杀区块-点击马上抢","秒杀区块-点击抢光啦","秒杀区块-点击提醒我","秒杀区块-点击取消提醒"];e.burying=function(a,b){toTalkingData({event:"周期团购",area:j[b],kv:{item_title:a.item.title,item_id:a.item.item_id.toString(),item_price:a.item.price.toString(),start_time:a.start_time.toString()},user:!0,time:!0})},h()}}}var duScrollDefaultEasing=function(a){"use strict";return.5>a?Math.pow(2*a,2)/2:1-Math.pow(2*(1-a),2)/2},duScroll=angular.module("duScroll",["duScroll.scrollspy","duScroll.smoothScroll","duScroll.scrollContainer","duScroll.spyContext","duScroll.scrollHelpers"]).value("duScrollDuration",350).value("duScrollSpyWait",100).value("duScrollGreedy",!1).value("duScrollOffset",0).value("duScrollEasing",duScrollDefaultEasing).value("duScrollCancelOnEvents","scroll mousedown mousewheel touchmove keydown").value("duScrollBottomSpy",!1).value("duScrollActiveClass","active");"undefined"!=typeof module&&module&&module.exports&&(module.exports=duScroll),angular.module("duScroll.scrollHelpers",["duScroll.requestAnimation"]).run(["$window","$q","cancelAnimation","requestAnimation","duScrollEasing","duScrollDuration","duScrollOffset","duScrollCancelOnEvents",function(a,b,c,d,e,f,g,h){"use strict";var i={},j=function(a){return"undefined"!=typeof HTMLDocument&&a instanceof HTMLDocument||a.nodeType&&a.nodeType===a.DOCUMENT_NODE},k=function(a){return"undefined"!=typeof HTMLElement&&a instanceof HTMLElement||a.nodeType&&a.nodeType===a.ELEMENT_NODE},l=function(a){return k(a)||j(a)?a:a[0]};i.duScrollTo=function(b,c,d,e){var f;if(angular.isElement(b)?f=this.duScrollToElement:angular.isDefined(d)&&(f=this.duScrollToAnimated),f)return f.apply(this,arguments);var g=l(this);return j(g)?a.scrollTo(b,c):(g.scrollLeft=b,void(g.scrollTop=c))};var m,n;i.duScrollToAnimated=function(a,f,g,i){g&&!i&&(i=e);var j=this.duScrollLeft(),k=this.duScrollTop(),l=Math.round(a-j),o=Math.round(f-k),p=null,q=0,r=this,s=function(a){(!a||q&&a.which>0)&&(h&&r.unbind(h,s),c(m),n.reject(),m=null)};if(m&&s(),n=b.defer(),0===g||!l&&!o)return 0===g&&r.duScrollTo(a,f),n.resolve(),n.promise;var t=function(a){null===p&&(p=a),q=a-p;var b=q>=g?1:i(q/g);r.scrollTo(j+Math.ceil(l*b),k+Math.ceil(o*b)),1>b?m=d(t):(h&&r.unbind(h,s),m=null,n.resolve())};return r.duScrollTo(j,k),h&&r.bind(h,s),m=d(t),n.promise},i.duScrollToElement=function(a,b,c,d){var e=l(this);(!angular.isNumber(b)||isNaN(b))&&(b=g);var f=this.duScrollTop()+l(a).getBoundingClientRect().top-b;return k(e)&&(f-=e.getBoundingClientRect().top),this.duScrollTo(0,f,c,d)},i.duScrollLeft=function(b,c,d){if(angular.isNumber(b))return this.duScrollTo(b,this.duScrollTop(),c,d);var e=l(this);return j(e)?a.scrollX||document.documentElement.scrollLeft||document.body.scrollLeft:e.scrollLeft},i.duScrollTop=function(b,c,d){if(angular.isNumber(b))return this.duScrollTo(this.duScrollLeft(),b,c,d);var e=l(this);return j(e)?a.scrollY||document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop},i.duScrollToElementAnimated=function(a,b,c,d){return this.duScrollToElement(a,b,c||f,d)},i.duScrollTopAnimated=function(a,b,c){return this.duScrollTop(a,b||f,c)},i.duScrollLeftAnimated=function(a,b,c){return this.duScrollLeft(a,b||f,c)},angular.forEach(i,function(a,b){angular.element.prototype[b]=a;var c=b.replace(/^duScroll/,"scroll");angular.isUndefined(angular.element.prototype[c])&&(angular.element.prototype[c]=a)})}]),angular.module("duScroll.polyfill",[]).factory("polyfill",["$window",function(a){"use strict";var b=["webkit","moz","o","ms"];return function(c,d){if(a[c])return a[c];for(var e,f=c.substr(0,1).toUpperCase()+c.substr(1),g=0;g<b.length;g++)if(e=b[g]+f,a[e])return a[e];return d}}]),angular.module("duScroll.requestAnimation",["duScroll.polyfill"]).factory("requestAnimation",["polyfill","$timeout",function(a,b){"use strict";var c=0,d=function(a,d){var e=(new Date).getTime(),f=Math.max(0,16-(e-c)),g=b(function(){a(e+f)},f);return c=e+f,g};return a("requestAnimationFrame",d)}]).factory("cancelAnimation",["polyfill","$timeout",function(a,b){"use strict";var c=function(a){b.cancel(a)};return a("cancelAnimationFrame",c)}]),angular.module("duScroll.spyAPI",["duScroll.scrollContainerAPI"]).factory("spyAPI",["$rootScope","$timeout","$window","$document","scrollContainerAPI","duScrollGreedy","duScrollSpyWait","duScrollBottomSpy","duScrollActiveClass",function(a,b,c,d,e,f,g,h,i){"use strict";var j=function(e){var j=!1,k=!1,l=function(){k=!1;var b,g=e.container,j=g[0],l=0;if("undefined"!=typeof HTMLElement&&j instanceof HTMLElement||j.nodeType&&j.nodeType===j.ELEMENT_NODE)l=j.getBoundingClientRect().top,b=Math.round(j.scrollTop+j.clientHeight)>=j.scrollHeight;else{var m=d[0].body.scrollHeight||d[0].documentElement.scrollHeight;b=Math.round(c.pageYOffset+c.innerHeight)>=m}var n,o,p,q,r,s,t=h&&b?"bottom":"top";for(q=e.spies,o=e.currentlyActive,p=void 0,n=0;n<q.length;n++)r=q[n],s=r.getTargetPosition(),s&&(h&&b||s.top+r.offset-l<20&&(f||-1*s.top+l)<s.height)&&(!p||p[t]<s[t])&&(p={spy:r},p[t]=s[t]);p&&(p=p.spy),o===p||f&&!p||(o&&(o.$element.removeClass(i),a.$broadcast("duScrollspy:becameInactive",o.$element,angular.element(o.getTargetElement()))),p&&(p.$element.addClass(i),a.$broadcast("duScrollspy:becameActive",p.$element,angular.element(p.getTargetElement()))),e.currentlyActive=p)};return g?function(){j?k=!0:(l(),j=b(function(){j=!1,k&&l()},g,!1))}:l},k={},l=function(a){var b=a.$id,c={spies:[]};return c.handler=j(c),k[b]=c,a.$on("$destroy",function(){m(a)}),b},m=function(a){var b=a.$id,c=k[b],d=c.container;d&&d.off("scroll",c.handler),delete k[b]},n=l(a),o=function(a){return k[a.$id]?k[a.$id]:a.$parent?o(a.$parent):k[n]},p=function(a){var b,c,d=a.$scope;if(d)return o(d);for(c in k)if(b=k[c],-1!==b.spies.indexOf(a))return b},q=function(a){for(;a.parentNode;)if(a=a.parentNode,a===document)return!0;return!1},r=function(a){var b=p(a);b&&(b.spies.push(a),b.container&&q(b.container)||(b.container&&b.container.off("scroll",b.handler),b.container=e.getContainer(a.$scope),b.container.on("scroll",b.handler).triggerHandler("scroll")))},s=function(b){var c=p(b);b===c.currentlyActive&&(a.$broadcast("duScrollspy:becameInactive",c.currentlyActive.$element),c.currentlyActive=null);var d=c.spies.indexOf(b);-1!==d&&c.spies.splice(d,1),b.$element=null};return{addSpy:r,removeSpy:s,createContext:l,destroyContext:m,getContextForScope:o}}]),angular.module("duScroll.scrollContainerAPI",[]).factory("scrollContainerAPI",["$document",function(a){"use strict";var b={},c=function(a,c){var d=a.$id;return b[d]=c,d},d=function(a){return b[a.$id]?a.$id:a.$parent?d(a.$parent):void 0},e=function(c){var e=d(c);return e?b[e]:a},f=function(a){var c=d(a);c&&delete b[c]};return{getContainerId:d,getContainer:e,setContainer:c,removeContainer:f}}]),angular.module("duScroll.smoothScroll",["duScroll.scrollHelpers","duScroll.scrollContainerAPI"]).directive("duSmoothScroll",["duScrollDuration","duScrollOffset","scrollContainerAPI",function(a,b,c){"use strict";return{link:function(d,e,f){e.on("click",function(e){if(f.href&&-1!==f.href.indexOf("#")||""!==f.duSmoothScroll){var g=f.href?f.href.replace(/.*(?=#[^\s]+$)/,"").substring(1):f.duSmoothScroll,h=document.getElementById(g)||document.getElementsByName(g)[0];if(h&&h.getBoundingClientRect){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var i=f.offset?parseInt(f.offset,10):b,j=f.duration?parseInt(f.duration,10):a,k=c.getContainer(d);k.duScrollToElement(angular.element(h),isNaN(i)?0:i,isNaN(j)?0:j)}}})}}}]),angular.module("duScroll.spyContext",["duScroll.spyAPI"]).directive("duSpyContext",["spyAPI",function(a){"use strict";return{restrict:"A",scope:!0,compile:function(b,c,d){return{pre:function(b,c,d,e){a.createContext(b)}}}}}]),angular.module("duScroll.scrollContainer",["duScroll.scrollContainerAPI"]).directive("duScrollContainer",["scrollContainerAPI",function(a){"use strict";return{restrict:"A",scope:!0,compile:function(b,c,d){return{pre:function(b,c,d,e){d.$observe("duScrollContainer",function(d){angular.isString(d)&&(d=document.getElementById(d)),d=angular.isElement(d)?angular.element(d):c,a.setContainer(b,d),b.$on("$destroy",function(){a.removeContainer(b)})})}}}}}]),angular.module("duScroll.scrollspy",["duScroll.spyAPI"]).directive("duScrollspy",["spyAPI","duScrollOffset","$timeout","$rootScope",function(a,b,c,d){"use strict";var e=function(a,b,c,d){angular.isElement(a)?this.target=a:angular.isString(a)&&(this.targetId=a),this.$scope=b,this.$element=c,this.offset=d};return e.prototype.getTargetElement=function(){return!this.target&&this.targetId&&(this.target=document.getElementById(this.targetId)||document.getElementsByName(this.targetId)[0]),this.target},e.prototype.getTargetPosition=function(){var a=this.getTargetElement();return a?a.getBoundingClientRect():void 0},e.prototype.flushTargetCache=function(){this.targetId&&(this.target=void 0)},{link:function(f,g,h){var i,j=h.ngHref||h.href;if(j&&-1!==j.indexOf("#")?i=j.replace(/.*(?=#[^\s]+$)/,"").substring(1):h.duScrollspy?i=h.duScrollspy:h.duSmoothScroll&&(i=h.duSmoothScroll),i){var k=c(function(){var c=new e(i,f,g,-(h.offset?parseInt(h.offset,10):b));a.addSpy(c),f.$on("$locationChangeSuccess",c.flushTargetCache.bind(c));var j=d.$on("$stateChangeSuccess",c.flushTargetCache.bind(c));f.$on("$destroy",function(){a.removeSpy(c),j()})},0,!1);f.$on("$destroy",function(){c.cancel(k)})}}}}]),function(a,b,c){"use strict";function d(){this.$get=["$location","$http","$q","$rootScope",function(a,c,d,e){function f(a){0==a&&b.element(document.getElementById("loading")).css({backgroundColor:"rgba(255,255,255,0)"}),e.showLoading=!1}function g(a,b,f,g,h){var i=d.defer(),j={method:f,url:g};if(h)if("POST"===f||"PUT"===f)j.data=h;else{var k,l="?";for(k in h)l+=k+"="+h[k]+"&";l=l.substr(0,l.length-1),j.url+=l}return a&&!e.showLoading&&(e.showLoading=!0),c(j).then(function(a){"POST"===f||"PUT"===f?200==a.data.status_code?i.resolve(a.data):(alert(a.data.message),b&&(e.showLoading=!1),i.reject(a.data)):i.resolve(a.data)},function(a){alert(g+","+a),i.reject(a)}).then(function(){b&&(e.showLoading=!1)}),i.promise}var h=this,i={yeyeReq:g},j={setUser:function(a){b.extend(h,{user:a})},getUser:function(){return h.user},updateUser:function(a){b.extend(h.user,a)},register:function(a,c){g(!0,!0,"POST",c,a).then(function(c){a.mobile=k.trim(a.mobile),a.email=k.trim(a.email),b.extend(h,{user:a}),history.back()},function(a){alert(a)})}},k={loaded:f,trim:function(a){return"number"==typeof a&&(a=a.toString()),a.split(" ").join("")},subStrByByte:function(a,b){for(var c="",d=0,e=0;e<a.length;e++)if(d+=/[^\x00-\xff]/g.test(a[e])?2:1,d>b)return c=a.substr(0,e),c+"...";return a}};return b.extend(i,j,k),i}]}b.module("yeyeFn",[]).provider("yeyeFn",d)}(window,window.angular);var userId=JSON.parse(document.body.dataset.init).hlj_id;angular.module("hljApp",["duScroll","ui.router","ngTouch","yeyeFn"]).constant({hlj_url:{defaultItemPic:"http://7xnzm2.com2.z0.glb.qiniucdn.com/default.png",noItemBg:"http://7xnzm2.com2.z0.glb.qiniucdn.com/noItemBg.jpg",reward:"http://7xnzm2.com2.z0.glb.qiniucdn.com/reward.jpg",operator:"http://7xnzm2.com2.z0.glb.qiniucdn.com/operator.png",callUsCode:"http://7xnzm2.com2.z0.glb.qiniucdn.com/uscode.jpg",noOrderBg:"http://7xnzm2.com2.z0.glb.qiniucdn.com/noOrderBg.png",checkMobile:"/api/buyerRegister/checkMobile",getVerifyCode:"/api/getVerificationCode",verifyCode:"/api/verifySMSCode",updateMobile:"/api/user/"+userId+"/mobileOrEmail",updateEmail:"/api/user/"+userId+"/mobileOrEmail",buyerRegister:"/api/buyerRegister/updateAccount",submitRequirement:"/api/user/"+userId+"/requirements",getActivityItems:"/api/buyPal/getGroupItems",getRewardItem:"/api/buyPal/getLuckyBagItem",getProvinces:"/api/regions/1",getSubRegions:"/api/region/",getAddresses:"/api/user/"+userId+"/addresses",createAddress:"/api/user/"+userId+"/addresses",updateAddress:"/api/user/"+userId+"/address/",deleteAddress:"/api/user/"+userId+"/address/",requirements:"/api/user/"+userId+"/requirements",orders:"/api/user/"+userId+"/subOrders",deleteRequirement:"/api/user/"+userId+"/requirement/",deleteOrder:"/api/user/"+userId+"/subOrder/",sureToComplete:"/api/user/"+userId+"/subOrder/",currentActivity:"/api/activities/current",activity:"/api/activity/",createOrder:"/api/user/"+userId+"/subOrders"},hlj_patt:{mobile:/^[0-9]{11}$/,email:/^([a-zA-Z0-9._-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/}}).value({isFirstIn:{main:!0,showReward:!1,fromBuypal:!0},isCountdown:{register:!1}}).value("duScrollDuration",500).run(["$rootScope","$state","$stateParams","$location","yeyeFn","modalService","buypalService","wxService","isFirstIn","isCountdown","hlj_url","hlj_patt",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(c,h,j){var k=h.split("#")[1],l=j.split("#")[1],m=0===g.getRequirement().length;if("/buypal"===k&&"/buypal"===l&&!i.main)return c.preventDefault(),o(),!1;if(i.main=!1,a.actualLocation=k,"/buypal"===k&&"/buypal/list"===l&&!m&&!a.hljModal.showModal)return c.preventDefault(),f.open("<p>已添加的商品将被删除，</p><p>确认返回？</p>",function(){g.requirement=[],history.back()}),!1;if(h.match("bottomState")){c.preventDefault();var n=l.split("/");if(j.match("buypal")&&e.getUser().isNewbuyer&&!i.showReward)return d.path("/buypal/reward").replace(),!1;var p;if(n.length>3)return p=n.slice(0,n.length-2).join("/"),d.path(p),!1;if(3==n.length)return b.go("periodActivity"),!1;o()}}function n(b,c,d){var e=c.split("#")[1],h=d.split("#")[1];a.hljModal.showModal&&(a.hljModal.showModal=!1,f.closeOther()),"/buypal"===e&&"/buypal/list"===h&&(g.requirement=[])}function o(){h.close()}a.showLoading=!0,a.$state=b,a.$stateParams=c,a.isCountdown=j,a.hlj_patt=l,a.hlj_url=k,a.$on("$locationChangeStart",m),a.$on("$locationChangeSuccess",n),a.$watch(function(){return d.path()},function(b,c){a.actualLocation===b&&("/periodActivity"==c||"/buyer"==c||"/buypal"==c&&!e.getUser().isNewbuyer)&&(d.path(c),o())})}]),wx.ready(function(){angular.element(document).ready(function(){angular.bootstrap(document,["hljApp"])})}),angular.module("hljApp").service("modalService",["$rootScope","$compile",function(a,b){function c(a){a.preventDefault(),a.stopPropagation()}function d(){document.addEventListener("touchmove",c,!1)}function e(){document.removeEventListener("touchmove",c,!1)}var f=angular.element(document.getElementById("modalContent"));a.hljModal={showModal:!1,close:function(){this.showModal=!1,e()}},this.openOther=d,this.closeOther=e,this.close=function(){a.hljModal.close()},this.open=function(b,c){d(),f.html(b),a.hljModal.showModal=!0,a.hljModal.accept=c}}]),angular.module("hljApp").service("buypalService",["$location","yeyeFn","hlj_url","wxService","isFirstIn","$state",function(a,b,c,d,e,f){var g=this;this.requirement=[],this.reward={},this.isGetReward=!1,this.buttonClick={saveItem:new Date,submitRequirement:new Date,buyReward:new Date},this.saveItem=function(b,c){var d=parseInt(c.itemId);return-2==d?a.path("buypal/list").replace():history.back(),new Date-g.buttonClick.saveItem<1e3?!1:(g.buttonClick.saveItem=new Date,0>d?g.requirement.push(b):g.requirement.splice(d,1,b),void toTalkingData({event:"帮我代购",area:"商品详情-点击确认",kv:{}}))},this.getItem=function(a){var b={title:"",number:1,pic_urls:[],localId:[]};if(a>-1){angular.extend(b,g.requirement[a]);var c=g.requirement[a].pic_urls.slice();b.pic_urls=c}return b},this.getRequirement=function(){return g.requirement},this.deleteItem=function(a){g.requirement.splice(a,1),0===g.requirement.length&&history.back()},this.editItem=function(b){a.path("/buypal/detail/"+b)},this.addPicture=function(a,b,c){a.stopPropagation(),d.uploadImage(b,c),toTalkingData({event:"帮我代购",area:"商品详情-添加图片",kv:{}})},this.previewPicture=function(a,b,c){a.stopPropagation(),d.previewImage(b,c)},this.deletePicture=function(a,b,c){a.stopPropagation(),c.pic_urls.splice(b,1),c.localId.splice(b,1)},this.submitRequirement=function(d){if(new Date-g.buttonClick.submitRequirement<1e3)return a.path("/buypal/submitted").replace(),!1;if(g.buttonClick.submitRequirement=new Date,b.getUser().mobile){var e=[];angular.forEach(d,function(a){var b={};angular.extend(b,a),delete b.localId,e.push(b)});var f={items:e};b.yeyeReq(!0,!0,"POST",c.submitRequirement,f).then(function(b){a.path("/buypal/submitted").replace(),g.requirement=[]}),toTalkingData({event:"帮我代购",area:"列表区块-点击提交",kv:{},time:!0,user:!0})}else a.path("/buyerRegister")},this.initReward=function(a){e.showReward?g.isGetReward&&(a.isGetReward=!0,a.item=g.reward):(a.isGetReward=!1,e.showReward=!0)},this.getReward=function(a){angular.element(document.getElementsByClassName("rewardContainer")[0]).addClass("fadeOut"),b.yeyeReq(!0,!0,"GET",c.getRewardItem).then(function(b){g.reward=b.data,a.item=b.data,a.isGetReward=!0,g.isGetReward=!0})},this.buyReward=function(d){if(new Date-g.buttonClick.buyReward<1e3)return!1;g.buttonClick.buyReward=new Date;var e={item_id:d.id,number:1};b.getUser().mobile?b.yeyeReq(!0,!0,"POST",c.createOrder,e).then(function(a){f.go("buyerAdmin.orders.list.pay",{state:"waitPay",id:a.data.id},{location:"replace"})}):a.path("/buyerRegister")}}]),angular.module("hljApp").service("dataService",["$rootScope","$interval","yeyeFn","hlj_url",function(a,b,c,d){function e(a,b,c){this.url=a,this.list=null,this.state=b,this.state_name=c,this.changed=!1,this.pendding=!1}e.prototype.refresh=function(d,e){var f=this;if(f.pendding){e||(a.showLoading=!0);var g=b(function(){f.pendding||(d(f),b.cancel(g))},200,10);return!1}f.pendding=!0,c.yeyeReq(!e,!1,"GET",f.url).then(function(a){a.data?f.list=a.data:f.list=a,a.meta&&(f.meta=a.meta),f.updateAt=new Date,f.changed=!1,f.pendding=!1,d(f)},function(a){f.pendding=!1})};var f={waitOffer:new e(d.requirements,0,"待报价"),waitPay:new e(d.orders+"/waitPay",201,"待付款"),waitDelivery:new e(d.orders+"/waitDelivery",501,"待发货"),delivered:new e(d.orders+"/delivered",601,"已发货"),completed:new e(d.orders+"/completed",301,"已完成")},g=new e(d.getProvinces),h=new e(d.getAddresses);this.data={orders:f,provinces:g,addresses:h,subRegions:{},logistics:{},activities:{}};var i=this;this.refreshData=function(a){var b=i.data[a]||i.data.orders[a]||i.data.orderDetail[a];if(b.changed===!1)b.changed=!0;else if(void 0===b.changed){var c;for(c in b)b[c].changed===!1&&(b[c].changed=!0)}},this.newData=function(a,b,c){return new e(a,b,c)},this.useData=function(b,c,d,e){var f=d?i.data[c][d]:i.data[c];f.list&&!f.changed?b(f):f.refresh(function(){a.showLoading=!1,b(f)},e)}}]),angular.module("hljApp").service("buyerService",["$rootScope","$location","yeyeFn","hlj_url","dataService","modalService","$state","$timeout",function(a,b,c,d,e,f,g,h){function i(){b.path().split("/").length>4&&history.back()}function j(a,d,g,h,j){f.open("<p>"+h+"</p>",function(){var h=b.path().split("/")[3];c.yeyeReq(!0,!0,d,g).then(function(b){200==b.status_code?(f.close(),angular.forEach(e.data.orders[h].list,function(b,c){return b.id==a?(e.data.orders[h].list.splice(c,1),j&&e.refreshData(j),!1):void 0}),i()):alert(b.message)})})}var k=this,l={code:0,name:"--请选择--",zip_code:""};this.getAreaList=function(a){return{provinces:[l].concat(e.data.provinces.list),cities:a>-1?[l,e.data.addresses.list[a].city]:[l],counties:a>-1?[l,e.data.addresses.list[a].city]:[l]}},this.getAddress=function(a){var b={id:"",receiver_name:"",receiver_mobile:"",province:l,city:l,county:l,street_address:"",zip_code:"",is_default:1};return a>-1&&angular.extend(b,e.data.addresses.list[a]),b},this.getSubRegions=function(a,b){e.data.subRegions[a.code]?e.useData(b,"subRegions",a.code):(e.data.subRegions[a.code]=e.newData(d.getSubRegions+a.code+"/subRegions"),k.getSubRegions(a,b))},this.toManagementAddress=function(){b.url("/buyer/addressManagement?fromChoose=true").replace()},this.createAddress=function(){b.path("/buyer/addressDetail/-1")},this.editAddress=function(a){b.path("/buyer/addressDetail/"+a)},this.saveAddress=function(a,f){var g,h;f>-1?(g=d.updateAddress+a.id,h="PUT"):(g=d.createAddress,h="POST");var i={};angular.extend(i,a),i.province=a.province.code,i.city=a.city.code,i.county=a.county.code,c.yeyeReq(!0,!0,h,g,i).then(function(c){1==a.is_default?angular.forEach(e.data.addresses.list,function(a,b){1==a.is_default&&b!=f&&(a.is_default=0)}):f>-1&&1==e.data.addresses.list[f].is_default&&(a.is_default=1),f>-1?e.data.addresses.list[f]=a:(a.id=c.id,e.data.addresses.list.push(a)),k.chose.address&&k.chose.address.id==a.id&&(k.chose.address=a),b.search().fromChoose&&k.chooseAddress(f),history.back()})},this.deleteAddress=function(a,b){f.open("<p>确认删除该地址？</p>",function(){c.yeyeReq(!0,!0,"DELETE",d.deleteAddress+a.id).then(function(c){200==c.status_code?(e.data.addresses.list.splice(b,1),1==a.is_default&&e.data.addresses.list.length>0&&(e.data.addresses.list[0].is_default=1),0==e.data.addresses.list.length&&(k.chose.address=void 0),f.close()):alert(c.message)})})},this.chose={},this.setDefaultAddressChose=function(){return angular.forEach(e.data.addresses.list,function(a){return 1==a.is_default?(k.chose.address=a,k.chose):void 0}),k.chose},this.setAddressChose=function(){return k.chose.address?k.chose.address:k.setDefaultAddressChose()},this.toChooseAddress=function(){e.data.addresses.list&&0!==e.data.addresses.list.length?b.path("/buyer/addressChoose"):b.path("/buyer/addressDetail/-1")},this.chooseAddress=function(a){h(function(){history.back()}),k.chose.address=e.data.addresses.list[-1==a?e.data.addresses.list.length-1:a];
},this.getOrder=function(a){var c,d=b.path().split("/")[3];for(c=0;c<e.data.orders[d].list.length;c++)if(a==e.data.orders[d].list[c].id)return e.data.orders[d].list[c]},this.loadMoreOrder=function(a,d){d.loadingMore=!0,c.yeyeReq(!1,!1,"GET",a.pagination.links.next).then(function(a){var c=b.path().split("/")[3];e.data.orders[c].list=e.data.orders[c].list.concat(a.data),e.data.orders[c].meta=a.meta,d.loadingMore=!1})},this.offset=0,this.checkOrder=function(a){g.go("buyerAdmin.orders.list.detail",{id:a}),k.offset=document.body.scrollTop},this.payNow=function(a,b){b?g.go("buyerAdmin.orders.list.pay",{id:a},{location:"replace"}):g.go("buyerAdmin.orders.list.pay",{id:a}),0==k.offset&&(k.offset=document.body.scrollTop)},this.sureToPay=function(a){pingpp_one.init({app_id:"app_WzDmrT0CC8G0HSen",order_no:a.order_number,amount:100*parseFloat(a.price),channel:["wx_pub"],charge_url:"/payment/requestPay",charge_param:{title:a.title.replace(/[\n\r]/,""),receiving_address_id:k.chose.address.id,user_id:userId},open_id:"olxLuv7ftcxC48-YGe6go_E-0FMo"},function(b){b.status?(angular.forEach(e.data.orders.waitPay.list,function(b,c){return b.id==a.id?(e.data.orders.waitPay.list.splice(c,1),e.refreshData("waitDelivery"),!1):void 0}),g.go("buyerAdmin.orders.list.pay.paySuccess",{id:a.id},{location:"replace"})):alert(b.msg)})},this.deleteOrder=function(a){var c=b.path().split("/")[3],e="waitOffer"===c?d.deleteRequirement+a:d.deleteOrder+a;j(a,"DELETE",e,"是否取消该订单？")},this.hideOrder=function(a){j(a,"DELETE",d.deleteOrder+a+"/hide","是否删除该订单？")},this.sureToComplete=function(a){j(a,"POST",d.sureToComplete+a+"/received","确认已收货？","completed")},this.checkRefund=function(a){var b='<div class="refundDetail">';a.map(function(a){b+="<p>退款金额： ￥"+(parseFloat(a.amount)/100).toFixed(2)+"</p><p>退款说明："+a.description+"</p><hr/>"}),b+="</div><p>退款通常5个工作日内到账</p>",f.open(b,function(){f.close()})},this.callOperator=function(a){f.open("<p>拨打客服电话："+a+"</p><p>（客服工作时间：9:00-18:00）</p>",function(){window.location.href="tel:"+a})},this.updateMobile=function(b,e){c.yeyeReq(!0,!0,"PUT",d.updateMobile,{mobile:b}).then(function(d){c.updateUser({mobile:b}),a.user.mobile=b,e("mobileEditM")})},this.updateEmail=function(b,e){b!=a.user.email?c.yeyeReq(!0,!0,"PUT",d.updateEmail,{email:b}).then(function(d){c.updateUser({email:b}),a.user.email=b,e("emailEditM")}):e("emailEditM")},this.initLogistics=function(a,b){e.data.logistics[a]?e.useData(b,"logistics",a,!0):(e.data.logistics[a]=e.newData("/api/subOrder/"+a+"/deliveryInfo"),k.initLogistics(a,b))}}]),angular.module("hljApp").service("wxService",function(){var a=function(b,c){var d=b[b.length-1];wx.uploadImage({localId:d,isShowProgressTips:1,success:function(d){b.pop();d.serverId;c.pic_urls.push(d.serverId),b.length>0&&a(b,c)}})};this.close=function(){wx.closeWindow()},this.uploadImage=function(b,c){wx.chooseImage({count:6-b.pic_urls.length,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(d){var e=d.localIds;b.localId=b.localId.concat(e),c.$apply(),a(e,b)}})},this.previewImage=function(a,b){wx.previewImage({current:b[a],urls:b})},this.onMenuShareTimeline=function(a){wx.onMenuShareTimeline(a)},this.onMenuShareAppMessage=function(a){wx.onMenuShareAppMessage(a)}}),angular.module("hljApp").service("activityService",["dataService","hlj_url","$interval","yeyeFn","$state","$stateParams",function(a,b,c,d,e,f){this.buttonClick={createOrder:new Date};var g=this;this.getActivity=function(c,d){if(a.data.activities[c])a.useData(d,"activities",c);else{var e="current"==c?b.currentActivity:b.activity+c;a.data.activities[c]=a.newData(e),g.getActivity(c,d)}},this.refresh=function(){a.refreshData("activities"),a.refreshData("currentKills"),a.refreshData("nextKills"),e.transitionTo(e.current,f,{reload:!0,inherit:!1,notify:!0})},this.createOrder=function(a){if(new Date-g.buttonClick.createOrder<1e3)return!1;g.buttonClick.createOrder=new Date;var c={item_id:a.id,order_memo:a.order_memo,number:a.number};d.yeyeReq(!0,!0,"POST",b.createOrder,c).then(function(a){e.go("buyerAdmin.orders.list.pay",{state:"waitPay",id:a.data.id})})}}]),angular.module("hljApp").directive("yeyePrevent",yeyePrevent).directive("yeyeBg",yeyeBg).directive("yeyePrice",yeyePrice).directive("yeyeNumber",yeyeNumber).directive("yeyeVerify",["yeyeFn","hlj_url",yeyeVerify]).directive("yeyeCountdown",["yeyeFn","hlj_url","isCountdown",yeyeCountdown]).directive("yeyeCarousel",["$interval","$state",yeyeCarousel]),angular.module("hljApp").directive("loading",loading).directive("overView",overView).directive("activityPreview",["yeyeFn","$location",activityPreview]).directive("logisticsPreview",["buyerService",logisticsPreview]).directive("yeyeTimer",["$interval",yeyeTimer]).directive("secKills",["$state","dataService","yeyeFn","hlj_url",secKills]),angular.module("hljApp").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/buypal"),a.state("bottom",{url:"/bottomState"}).state("buyerRegister",{url:"/buyerRegister",templateUrl:"/views/wx-app/buyer_register.html?"+ +new Date,controller:"buyerRegisterCtrl"}).state("buypal",{url:"/buypal",templateUrl:"/views/wx-app/buypal/buypal.html?"+ +new Date,controller:"buypalCtrl"}).state("buypal.itemList",{url:"/list",templateUrl:"/views/wx-app/buypal/item_list.html?"+ +new Date,controller:"itemListCtrl"}).state("buypal.itemDetail",{url:"/detail/:itemId",templateUrl:"/views/wx-app/buypal/item_detail.html?"+ +new Date,controller:"itemDetailCtrl"}).state("buypal.reward",{url:"/reward",templateUrl:"/views/wx-app/buypal/reward.html?"+ +new Date,controller:"rewardCtrl"}).state("buypal.submitted",{url:"/submitted",templateUrl:"/views/wx-app/buypal/submitted.html?"+ +new Date,controller:"submittedCtrl"}).state("buyerAdmin",{url:"/buyer",templateUrl:"/views/wx-app/buyer/buyer_admin.html?"+ +new Date,controller:"buyerCtrl"}).state("buyerAdmin.callUs",{url:"/callUs",templateUrl:"/views/wx-app/buyer/call_us.html? + + new Date()"}).state("buyerAdmin.profile",{url:"/profile",templateUrl:"/views/wx-app/buyer/buyer_profile.html?"+ +new Date,controller:"buyerProfileCtrl"}).state("buyerAdmin.addressChoose",{url:"/addressChoose",templateUrl:"/views/wx-app/buyer/address_list.html?"+ +new Date,controller:"addressChooseCtrl"}).state("buyerAdmin.addressManagement",{url:"/addressManagement",templateUrl:"/views/wx-app/buyer/address_list.html?"+ +new Date,controller:"addressManagementCtrl"}).state("buyerAdmin.addressDetail",{url:"/addressDetail/:addressId",templateUrl:"/views/wx-app/buyer/address_detail.html?"+ +new Date,controller:"addressDetailCtrl"}).state("buyerAdmin.orders",{url:"/orders",templateUrl:"/views/wx-app/buyer/order.html?"+ +new Date,controller:"orderCtrl"}).state("buyerAdmin.orders.list",{url:"/{state: /|waitOffer|waitPay|waitDelivery|delivered|completed|/}",templateUrl:"/views/wx-app/buyer/order_list.html?"+ +new Date,controller:"orderListCtrl"}).state("buyerAdmin.orders.list.pay",{url:"/pay/:id",templateUrl:"/views/wx-app/buyer/order_pay_detail.html?"+ +new Date,controller:"orderDetailCtrl"}).state("buyerAdmin.orders.list.pay.paySuccess",{url:"/paySuccess",templateUrl:"/views/wx-app/buyer/pay_success.html?"+ +new Date,controller:"paySuccessCtrl"}).state("buyerAdmin.orders.list.detail",{url:"/detail/:id",templateUrl:"/views/wx-app/buyer/order_detail.html?"+ +new Date,controller:"orderDetailCtrl"}).state("buyerAdmin.orders.list.detail.item",{url:"/item/:index",templateUrl:"/views/wx-app/buyer/order_item_detail.html?"+ +new Date,controller:"orderItemDetailCtrl"}).state("buyerAdmin.orders.list.detail.logistics",{url:"/logistics/:orderId",templateUrl:"/views/wx-app/buyer/logistics_detail.html?"+ +new Date,controller:"logisticsCtrl"}).state("periodActivity",{url:"/periodActivity",templateUrl:"/views/wx-app/activity/activity.html?"+ +new Date,controller:"activityCtrl"}).state("activity",{url:"/activity/:id",templateUrl:"/views/wx-app/activity/activity.html?"+ +new Date,controller:"activityCtrl"})}]),angular.module("hljApp").controller("mainCtrl",["$scope","yeyeFn","$location","wxService","$rootScope",function(a,b,c,d,e){location.hash.match(["#/buypal/reward"])&&d.close(),b.setUser(JSON.parse(document.body.dataset.init)),a.stop=function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()},e.user={},angular.extend(e.user,b.getUser()),a.substr=function(a,c){var d=b.subStrByByte(a,c);return";"==d[d.length-1]?d.substr(0,d.length-1):d},a.doubleNumber=function(a){return a>9?a:"0"+a},b.loaded(0)}]),angular.module("hljApp").controller("buyerRegisterCtrl",["$scope","yeyeFn",function(a,b){a.getVerifyCode=b.getVerifyCode,a.register=b.register}]),angular.module("hljApp").controller("buypalCtrl",["$scope","buypalService",function(a,b){a.requirement=b.getRequirement(),toTalkingData({event:"帮我代购PV",area:"",kv:{},user:!0,time:!0})}]).controller("itemListCtrl",["$scope","buypalService","$timeout",function(a,b,c){function d(){a.totalNumber=a.requirement.length>0?a.requirement.map(function(a){return a.number}).reduce(function(a,b){return a+b}):0}a.requirement=b.getRequirement(),d(),a.deleteItem=function(a){b.deleteItem(a),d()},a.editItem=b.editItem,a.submitRequirement=b.submitRequirement,c(function(){window.scrollTo(0,document.body.clientHeight)},0)}]).controller("itemDetailCtrl",["$scope","$stateParams","buypalService",function(a,b,c){a.item=c.getItem(b.itemId),a.addPicture=function(b,d){c.addPicture(b,d,a)},a.previewPicture=c.previewPicture,a.deletePicture=c.deletePicture,a.saveItem=c.saveItem,-2==b.itemId?toTalkingData({event:"帮我代购",area:"空列表区块-点击添加",kv:{},time:!0,user:!0}):-1==b.itemId&&toTalkingData({event:"帮我代购",area:"列表区块-点击添加",kv:{},time:!0,user:!0})}]).controller("rewardCtrl",["$scope","buypalService",function(a,b){b.initReward(a),a.getReward=function(){b.getReward(a)},a.buyReward=b.buyReward}]).controller("submittedCtrl",["$scope",function(a){}]),angular.module("hljApp").controller("buyerCtrl",["$scope","yeyeFn","dataService",function(a,b,c){a.orderNumber={waitPayNumber:0},c.refreshData("waitOffer"),c.refreshData("waitPay"),c.data.addresses.refresh(function(){},!0),c.data.orders.waitPay.refresh(function(b){a.orderNumber.waitPayNumber=b.list.length},!0)}]).controller("buyerProfileCtrl",["$scope","buyerService","modalService",function(a,b,c){a.showEdit=function(b,d){c.openOther(),a[b]=d,a[b+"M"]=!0},a.close=function(b){c.closeOther(),a[b]=!1},a.updateMobile=b.updateMobile,a.updateEmail=b.updateEmail,a.$on("$destroy",a.close)}]).controller("addressChooseCtrl",["$scope","buyerService","dataService",function(a,b,c){a.state="choose",a.dealer="管理收货地址",a.chose=b.chose,a.checkAddress=b.chooseAddress,a.dealAddress=b.toManagementAddress,c.useData(function(b){a.addresses=b},"addresses")}]).controller("addressManagementCtrl",["$scope","buyerService","dataService",function(a,b,c){a.state="management",a.dealer="添加新地址",a.checkAddress=b.editAddress,a.dealAddress=b.createAddress,a.deleteAddress=b.deleteAddress,c.useData(function(b){a.addresses=b},"addresses")}]).controller("addressDetailCtrl",["$scope","$timeout","buyerService","$stateParams","dataService",function(a,b,c,d,e){var f={code:0,name:"--请选择--",zip_code:""},g={cityReady:!1,countyReady:!1,zip_codeReady:!1};e.useData(function(){a.hasNoAddress=!e.data.addresses.list.length},"addresses"),e.useData(function(){a.areaList=c.getAreaList(d.addressId)},"provinces"),a.address=c.getAddress(d.addressId),a.changeDefault=function(){0==a.address.is_default?a.address.is_default=1:a.address.is_default=0},a.checkForm=function(){a.form.check=!0,b(function(){a.form&&(a.form.check=!1)},1500)},a.saveAddress=c.saveAddress,a.$watch("address.province",function(b){return g.cityReady&&(a.areaList.cities=[f],a.areaList.counties=[f],a.address.city=f,a.address.county=f),0===b.code?!1:void c.getSubRegions(b,function(b){a.areaList.cities=[f].concat(b.list),g.cityReady||(g.cityReady=!0)})}),a.$watch("address.city",function(b){return g.countyReady&&(a.areaList.counties=[f],a.address.county=f),0===b.code?!1:void c.getSubRegions(b,function(b){a.areaList.counties=[f].concat(b.list),g.countyReady||(g.countyReady=!0)})}),a.$watch("address.county",function(b){g.zip_codeReady?a.address.zip_code=b.zip_code:g.zip_codeReady=!0})}]).controller("orderCtrl",["$scope","buyerService",function(a,b){a.deleteOrder=b.deleteOrder,a.callOperator=b.callOperator,a.sureToComplete=b.sureToComplete,a.hideOrder=b.hideOrder,a.checkRefund=b.checkRefund}]).controller("orderListCtrl",["$scope","buyerService","dataService","$location","$stateParams","$timeout","$anchorScroll",function(a,b,c,d,e,f,g){"waitPay"===e.state&&a.$watchCollection("orders.list",function(b){b&&(a.orderNumber.waitPayNumber=b.length)}),d.hash("buyerAdmin"),c.useData(function(c){a.orders=c,f(function(){g(),b.offset=0})},"orders",e.state),a.checkOrder=b.checkOrder,a.payNow=b.payNow,a.loadingMore=!1,a.loadMoreOrder=function(c){b.loadMoreOrder(c,a)},a.$on("$destroy",function(){g.yOffset=0})}]).controller("orderDetailCtrl",["$scope","$stateParams","buyerService","dataService","$document","$anchorScroll",function(a,b,c,d,e,f){a.$on("$destroy",function(){f.yOffset=-c.offset}),f.yOffset=0,f(),a.sureToPay=c.sureToPay,d.useData(function(d){a.orders=d,a.order=c.getOrder(b.id)},"orders",b.state),d.useData(function(){c.setAddressChose(),a.chose=c.chose,a.toChooseAddress=c.toChooseAddress},"addresses")}]).controller("paySuccessCtrl",["$scope","$state",function(a,b){a.day=7,"美国"==a.order.country&&(a.day=10),a.back=function(){b.go("buyerAdmin",{},{location:"replace"})}}]).controller("orderItemDetailCtrl",["$scope","$stateParams","wxService",function(a,b,c){a.items=a.order.details,a.index=b.index,a.previewImage=c.previewImage}]).controller("logisticsCtrl",["$scope","buyerService","$stateParams",function(a,b,c){var d=c.orderId;b.initLogistics(d,function(b){a.logistics=b.list})}]),angular.module("hljApp").controller("activityCtrl",["$scope","modalService","activityService","$timeout","$document","$location","$stateParams","wxService","yeyeFn",function(a,b,c,d,e,f,g,h,i){var j=g.id?g.id:"current";a.carouselPics=[],a.carouselTargets=[],a.hours=0,a.minutes=0,a.seconds=0,c.getActivity(j,function(b){h.onMenuShareTimeline({title:b.list.share.title,link:location.href+"?title="+b.list.share.title+"&description="+b.list.share.description+"&imgUrl="+b.list.share.pic_url,imgUrl:b.list.share.pic_url,success:function(){toTalkingData({event:"成功转发到朋友圈",area:"current"==j?"今日团购":"主题性活动",kv:{activity_title:a.activity.activity_title,activity_id:a.activity.activity_id.toString()},user:!0,time:!0}),toTalkingData({event:"转发到朋友圈",area:"current"==j?"今日团购":"主题性活动",kv:{activity_title:a.activity.activity_title,activity_id:a.activity.activity_id.toString()},user:!0,time:!0})},cancel:function(){toTalkingData({event:"转发到朋友圈",area:"current"==j?"今日团购":"主题性活动",kv:{activity_title:a.activity.activity_title,activity_id:a.activity.activity_id.toString()},user:!0,time:!0})}}),h.onMenuShareAppMessage({title:b.list.share.title,link:location.href+"?title="+b.list.share.title+"&description="+b.list.share.description+"&imgUrl="+b.list.share.pic_url,desc:b.list.share.description,imgUrl:b.list.share.pic_url,success:function(){toTalkingData({event:"成功转发个人或群",area:"current"==j?"今日团购":"主题性活动",kv:{activity_title:a.activity.activity_title,activity_id:a.activity.activity_id.toString()},user:!0,time:!0}),toTalkingData({event:"转发个人或群",area:"current"==j?"今日团购":"主题性活动",kv:{activity_title:a.activity.activity_title,activity_id:a.activity.activity_id.toString()},user:!0,time:!0})},cancel:function(){toTalkingData({event:"转发个人或群",area:"current"==j?"今日团购":"主题性活动",kv:{activity_title:a.activity.activity_title,activity_id:a.activity.activity_id.toString()},user:!0,time:!0})}});var c=[],g=[];b.list.themeActivities.map(function(a){c.push(a.picture),g.push({state:"activity",id:a.id,title:a.activity_title})}),a.carouselPics=c,a.carouselTargets=g,a.activity=b.list,a.updateAt=b.updateAt,a.activityShow=a.activity.details,d(function(){if(f.hash()){var a=angular.element(document.getElementById(f.hash()));e.scrollToElementAnimated(a),f.hash("").replace()}else e.scrollToElement(angular.element(document.getElementById("activity")))})}),a.aState="today",a["switch"]=function(b){a.aState=b,a.activityShow="today"==b?a.activity.details:a.activity.nextDetails,"next"==b&&toTalkingData({event:"周期团购",area:"点击明日预告",kv:{}})},a.buyNow=function(c,d){return i.getUser().mobile?(a.itemB={number:c.buy_per_user>0?1:0,order_memo:""},angular.extend(a.itemB,c),b.openOther(),a.buyModal=!0,void toTalkingData({event:"current"==j?"周期团购":"主题性活动",area:"商品区块-点击立即购买",kv:{activity_title:a.activity.activity_title,activity_id:a.activity.activity_id.toString(),item_title:c.title,item_id:c.id.toString(),item_index:(d+1).toString()},user:!0})):(f.path("/buyerRegister"),!1)},a.close=function(){b.closeOther(),a.buyModal=!1},a.buy=c.createOrder,a.$on("$destroy",function(){a.close()}),"current"==j?toTalkingData({event:"今日团购PV",area:"",kv:{},user:!0,time:!0}):toTalkingData({event:"主题性活动PV",area:"",kv:{},user:!0,time:!0}),a.refresh=c.refresh}]);